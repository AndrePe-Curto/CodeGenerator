<!DOCTYPE html>
<html lang="pt-PT">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gerador de Código Único — Anónimo</title>
<style>
  :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; color:#222}
  body{max-width:760px;margin:32px auto;padding:20px}
  h1{margin:0 0 8px;font-size:1.6rem}
  p.lead{margin:0 0 18px;color:#444}
  .card{border:1px solid #e6e6e6;padding:18px;border-radius:10px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,0.03)}
  .controls{display:flex;flex-wrap:wrap;gap:8px;margin-top:14px}
  button {padding:10px 14px;border-radius:8px;border:0;background:#0366d6;color:#fff;font-weight:600;cursor:pointer}
  button.secondary{background:#6c757d}
  button:hover{opacity:0.9}
  #codigo{font-family:monospace;margin:14px 0;font-size:1.4rem;word-break:break-all;color:#003366}
  .hint{font-size:0.95rem;color:#333;margin-top:12px}
  ul.suggestions{margin:10px 0 0 18px;color:#333}
  .qr {margin-top:12px}
  #qrImg{display:inline-block;padding:10px;background:#fff;border:1px solid #ddd;border-radius:8px}
  footer{margin-top:18px;color:#666;font-size:0.9rem}
  @media print {
    .controls{display:none}
    footer{display:none}
  }
</style>
</head>
<body>
  <h1>Gerador de Código Único (anónimo)</h1>
  <p class="lead">Gere um código curto e único para usar no questionário. <strong>Este serviço não guarda nem envia o seu email.</strong> Se perder o código, <strong>não será possível recuperá-lo</strong>.</p>

  <div class="card">
    <div>
      <label><strong>Seu código único:</strong></label>
      <div id="codigo">— ainda não gerado —</div>
    </div>

    <div class="controls">
      <button id="btnGerar">Gerar código</button>
      <button id="btnCopiar" class="secondary">Copiar</button>
      <button id="btnDownload" class="secondary">Descarregar (.txt)</button>
      <button id="btnMail" class="secondary">Abrir email</button>
      <button id="btnPrint" class="secondary">Imprimir</button>
    </div>

    <div class="qr" id="qrWrap" style="display:none">
      <label><strong>QR (opcional):</strong></label>
      <div id="qrImg"></div>
    </div>
  </div>

  <footer>
    Se tiver dúvidas sobre onde guardar o código, escolha enviar para o seu próprio e-mail.
  </footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
const LETTERS = 'ABCDEFGHJKLMNPQRSTUVWXYZ';
const NUMBERS = '23456789';
let currentCode = '';

function generateShortGuid() {
  const letterArray = new Uint8Array(4);
  const numberArray = new Uint8Array(2);
  crypto.getRandomValues(letterArray);
  crypto.getRandomValues(numberArray);
  
  let out = '';
  for (let i = 0; i < 4; i++) {
    out += LETTERS[letterArray[i] % LETTERS.length];
  }
  for (let i = 0; i < 2; i++) {
    out += NUMBERS[numberArray[i] % NUMBERS.length];
  }
  return out;
}

function displayCode(c) {
  document.getElementById('codigo').textContent = c;
}

document.getElementById('btnGerar').addEventListener('click', () => {
  currentCode = generateShortGuid();
  displayCode(currentCode);
  document.getElementById('qrImg').innerHTML = "";
  new QRCode(document.getElementById("qrImg"), {
    text: currentCode,
    width: 200,
    height: 200
  });
  document.getElementById('qrWrap').style.display = 'block';
});

document.getElementById('btnCopiar').addEventListener('click', async () => {
  if (!currentCode) return alert('Primeiro gere o código.');
  await navigator.clipboard.writeText(currentCode);
  alert('Código copiado: ' + currentCode);
});

document.getElementById('btnDownload').addEventListener('click', () => {
  if (!currentCode) return alert('Primeiro gere o código.');
  const blob = new Blob([currentCode], { type: 'text/plain;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; 
  a.download = 'codigo-unico.txt';
  a.click();
  URL.revokeObjectURL(url);
});

document.getElementById('btnMail').addEventListener('click', () => {
  if (!currentCode) return alert('Primeiro gere o código.');
  const subject = encodeURIComponent('Meu código para o questionário');
  const body = encodeURIComponent('O meu código único é:\n\n' + currentCode);
  window.location.href = `mailto:?subject=${subject}&body=${body}`;
});

document.getElementById('btnPrint').addEventListener('click', () => {
  if (!currentCode) return alert('Primeiro gere o código.');
  window.print();
});
</script>
</body>
</html>